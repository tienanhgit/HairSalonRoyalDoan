
@{
    Layout = "~/Views/Shared/_AdminHome.cshtml";

}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link href="~/CSS/Library/jquery-ui-1.12.1/jquery-ui.css" rel="stylesheet" />



</head>
<body>

    <div id="main">
        <ol class="breadcrumb">
            <li><a href="/AdminHome/Index"><i class="fa fa-home"></i> Trang quản trị</a></li>
            <li class="active"><a href="/AdminDonSanPham/Index">Đơn đặt hàng</a></li>
        </ol>
        <div class="col-xs-12">
            <h3>Lịch hẹn </h3>

            <form id="post_form" method="post" action="" role="form">
                <div class="col-xs-12">
                    <div class="form-group col-xs-12">
                        <!-- Single button -->
                        <div class="col-xs-4">
                            <label>Chọn ngày: </label>
                            <span> <input type="text" id="datepicker"></span>
                            <button><i class="fa fa-search"></i></button>
                        </div>
                        <div class="col-xs-4">
                            <select id="ttdondathang" style="width:100%;height:25px">
                                <option disabled>Trạng Thái</option>
                                <option>Đã xác nhận</option>
                                <option>Đã đến </option>
                                <option>Hủy </option>

                            </select>
                        </div>

                        <div class="btn-group pull-right hidden-xs col-xs-4" id="div-search">
                            <span><input id="SearchString" name="search" type="text" value="" placeholder="Tìm kiếm"></span><button type="button" onclick="Search();"><i class="fa fa-search"></i></button>

                        </div>
                    </div>
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th class="hidden-xs">Mã Lịch Hẹn</th>
                                <th>Tên Khách Hàng</th>

                                <th>Tên Nhân Viên Cắt</th>
                                <th>Số điện thoại</th>
                                <th>Ngày Hẹn</th>
                                <th>Giờ Hẹn</th>
                                <th>Cập nhật</th>
                                <th>Trạng Thái</th>
                            </tr>
                        </thead>
                        <tbody class="listls-dxn">
                        </tbody>
                    </table>

                    <div class="card-footer">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination" id="load-pagination">
                            </ul>
                        </nav>
                    </div>

                    <div class="text-right">
                        <ul class="pagination" id="step5">

                            @*@Html.PagedListPager(Model, page => Url.Action("Index", new { page }))*@

                        </ul>
                    </div>
                </div>
            </form>

        </div>
        <div class="col-xs-12">
            <h3>Lịch hẹn chờ xác nhận</h3>
            <div class="col-xs-12">
                <span style="font-size:20px">Làm mới :</span><button onclick="loadlichhen()"><i class="fa fa-refresh" aria-hidden="true"></i></button>

            </div>

            <form id="post_form" method="post" action="" role="form">
                <div class="col-xs-12  table-lich-hen-dang-den">

                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th class="hidden-xs">Mã Lịch Hẹn</th>
                                <th>Tên Khách Hàng</th>
                                <th>Tên Nhân Viên Cắt</th>
                                <th>Số điện thoại</th>
                                <th>Ngày Hẹn</th>
                                <th>Giờ Hẹn</th>
                                <th>Cập nhật</th>
                                <th>Trạng Thái</th>
                            </tr>
                        </thead>
                        <tbody class="row-table-lich-moi">
                        </tbody>
                    </table>

                </div>
            </form>

        </div>
    </div>
    <script src="~/CSS/Library/jquery-ui-1.12.1/jquery-ui.js"></script>

    <script type="text/javascript">


        function load(txtsearch, page) {

            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: "{'searchString':'" + txtsearch + "','page':'" + page + "'}",
                url: "/AdminLichHen/Index",
                dataType: "json",
                success: function (result) {
                    console.log(result);
                    $(".listls-dxn").empty();
                    var html = '';
                    $.each(result.data, function (key, item) {
                        html += '<tr>';
                        html += '<td>' + item.MaLichHen + '</td>';
                        html += '<td>' + item.TenKhachHang + '</td>';
                        html += '<td>' + item.TenNhanVien + '</td>';
                        html += '<td>0' + item.SoDTKH + '</td>';
                        html += '<td>' + $.datepicker.formatDate('dd/mm/yy', new Date(item.NgayHen)) + '</td>';
                        html += '<td>' + item.GioHen + '</td>';
                        html += '<td>' + '<div onclick="SuaTrangThaiBelow(' + item.MaLichHen + ')"><a><i class="fa fa-edit" data-toggle="tooltip" data-placement="top" title="Cập nhật"></i> </a><div/>' + '</td>';
                        html += '<td><select  class="ttlichhenbelow-' + item.MaLichHen + '"  style="width:100%;height:25px"><option value="1">Chưa xác nhận</option><option value="2">Đã xác nhận</option><option value="3">Hủy</option><option value="4"><a href="" >Đã đến<a></option> </select></td>';
                    });
                    var pagination_string = "";

                    var pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }

                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            html += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }


                    $("#load-pagination").html(pagination_string);


                    $('.listls-dxn').html(html);

                },
                error: function (data) {


                }
            });


        }


        $("body").on("click", ".pagination li a", function (event) {
            event.preventDefault();
            var page = $(this).attr('data-page');

            //load event pagination
            var txtSearch = $("#SearchString").val();
            if (txtSearch != "") {
                load(txtSearch, page)
            }
            else {
                load("", page);
            }
        });


        function Search() {
            var searchvalue = $("#SearchString").val();
            if (searchvalue != null) {
                load(searchvalue, 1);
            }
            else {
                load("", 1);
            }


        }

        $(document).ready(function () {
            load("", 1);

            $(function () {
                $("#datepicker").datepicker();
            });


            loadlichhen();
            setInterval(function () {


                loadlichhen();

            }, 300000);
        });
        function SuaTrangThai(MaLichHen) {
            var TrangThai = $("#ttlichhen-" + MaLichHen + " option:selected").val();
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '/AdminLichHen/UpdateTrangThai',
                data: "{'MaLichHen':'" + MaLichHen + "','TrangThai':'" + TrangThai + "'}",
                dataType: "json",
                success: function (data) {
                },
                error: function (data) {

                    alert(data);
                }
            });
            alert("Cập nhật trạng thái đơn đặt hàng thành công");
        }

        function SuaTrangThaiBelow(MaLichHen) {
            var TrangThai = $(".ttlichhenbelow-" + MaLichHen + " option:selected").val();
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '/AdminLichHen/UpdateTrangThai',
                data: "{'MaLichHen':'" + MaLichHen + "','TrangThai':'" + TrangThai + "'}",
                dataType: "json",
                success: function (data) {
                },
                error: function (data) {

                    alert(data);
                }
            });

            loadlichhen();

            alert("Cập nhật trạng thái đơn đặt hàng thành công");
        }








        function loadlichhen() {
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '/AdminLichHen/LichHenLamMoi',
                dataType: "json",
                success: function (result) {

                    var html = '';
                    $.each(result, function (key, item) {
                        html += '<tr>';
                        html += '<td>' + item.MaLichHen + '</td>';
                        html += '<td>' + item.TenKhachHang + '</td>';
                        html += '<td>0' + item.SoDTKH + '</td>';
                        html += '<td>' + item.TenNhanVien + '</td>';
                        html += '<td>' + $.datepicker.formatDate('dd/mm/yy', new Date(item.NgayHen)) + '</td>';
                        html += '<td>' + item.GioHen + '</td>';
                        html += '<td>' + '<div onclick="SuaTrangThaiBelow(' + item.MaLichHen + ')"><a><i class="fa fa-edit" data-toggle="tooltip" data-placement="top" title="Cập nhật"></i> </a><div/>' + '</td>';
                        html += '<td><select  class="ttlichhenbelow-' + item.MaLichHen + '"  style="width:100%;height:25px"><option value="1">Chưa xác nhận</option><option value="2">Đã xác nhận</option><option value="3">Hủy</option> </select></td>';
                        html += '<td>' + + '</td>';
                    });
                    html += '<tr/>';
                    $('.row-table-lich-moi').html(html);



                },
                error: function (data) {


                }
            });




        }






    </script>



</body>
</html>
