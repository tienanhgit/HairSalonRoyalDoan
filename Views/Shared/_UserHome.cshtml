@using HairSalonRoyalDoan.Models.Dictionary
@{
    ViewBag.Title = "_UserHome";
    KhungThoiGianModel khungThoiGianModel = new KhungThoiGianModel();
    DichVuModel dichVuModel = new DichVuModel();
    DonDatHangModel donDatHangModel = new DonDatHangModel();




}
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <link href="~/CSS/User/Layouttemplate.css" rel="stylesheet" />
    <link href="~/CSS/Common/Library.css" rel="stylesheet" />

    <link href="~/CSS/Library/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Scripts/Common/Library/jquery-3.4.1.js"></script>




    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <style>
        .dialog-datlich {
            background-image: url('../../Content/Images/UserHomeImg/banner.jpg');
        }

        .ui-dialog-title {
        }

        .ui-widget-overlay {
            background: rgba(0,0,0,0.5);
            opacity: 1;
        }

        .ui-dialog .ui-dialog-title {
            height: 30px;
            display: flex;
            font-size: 16px;
            font-weight: bold;
            align-items: center;
        }

        .ui-dialog {
            padding: 0px;
        }

            .ui-dialog .ui-dialog-content {
                background-image: url('../../Content/Images/UserHomeImg/background.jpg');
                padding: 0px;
            }
        /*Đây là css cho phần chung của content dialog*/
        .container-dialog-main {
            padding: 8px;
        }

        .container-dialog-main {
            white-space: nowrap;
        }



        body {
            background-color: #f1f1f1;
        }

        #regForm {
            background-color: #ffffff;
            margin: 100px auto;
            font-family: Raleway;
            padding: 40px;
            width: 70%;
            min-width: 300px;
        }

        h1 {
            text-align: center;
        }

        input {
            padding: 10px;
            width: 100%;
            font-size: 17px;
            font-family: Raleway;
            border: 1px solid #aaaaaa;
        }

            /* Mark input boxes that gets an error on validation: */
            input.invalid {
                background-color: #ffdddd;
            }

        /* Hide all steps by default: */
        .tab {
            display: none;
        }

        button {
            background-color: #4CAF50;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            font-size: 17px;
            font-family: Raleway;
            cursor: pointer;
        }

            button:hover {
                opacity: 0.8;
            }

        #prevBtn {
            background-color: #bbbbbb;
        }

        /* Make circles that indicate the steps of the form: */
        .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbbbbb;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.5;
        }

            .step.active {
                opacity: 1;
            }

            /* Mark the steps that are finished and valid: */
            .step.finish {
                background-color: #4CAF50;
            }




/*custom lai check box*/
        .container-ckbox {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 22px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

            /* Hide the browser's default checkbox */
            .container-ckbox input {
                position: absolute;
                opacity: 0;
                cursor: pointer;
                height: 0;
                width: 0;
            }

        /* Create a custom checkbox */
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 25px;
            width: 25px;
            background-color: #eee;
        }

        /* On mouse-over, add a grey background color */
        .container-ckbox:hover input ~ .checkmark {
            background-color: #ccc;
        }

        /* When the checkbox is checked, add a blue background */
        .container-ckbox input:checked ~ .checkmark {
            background-color: #2196F3;
        }

        /* Create the checkmark/indicator (hidden when not checked) */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the checkmark when checked */
        .container-ckbox input:checked ~ .checkmark:after {
            display: block;
        }

        /* Style the checkmark/indicator */
        .container-ckbox .checkmark:after {
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }
    </style>
</head>
<body>


    <div class="header">
        <a href="/UserHome/Index" class="logo">
            <img src="~/Content/Images/UserHomeImg/logo.jpg" />
        </a>
        <div class="header-right" id="header-right">
            <a href="/UserHome/BaiViet">GIỚI THIỆU</a>
            <a href="/UserProduct/Index">ROYAL ĐOÀN STORE</a>
            <a class="buttondatlich">ĐẶT LỊCH</a>
            <a href="/UserHome/XemDichVu">DỊCH VỤ</a>
            <a href="/KhachHang/DangNhap" id="usdn">ĐĂNG NHẬP</a>
        </div>
    </div>
    <div class="dialog-datlich" title="ĐẶT LỊCH ONLINE">


        <!-- One "tab" for each step in the form: -->
        <div class="tab">
            <form>
                <div class="container">
                    <div class="row mt-12">
                        <div class="col-md-4 col-lg-3"></div>
                        <div class="col-md-4 col-lg-6" style="background:gray;">
                            <h3 class="mt-3">CHỌN NGÀY CẮT</h3>
                        </div>
                        <div class="col-md-4 col-lg-3"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 col-lg-3"></div>
                        <div class="col-md-4 col-lg-6" style="background:gray;">
                            <div>
                                <select name="ngayhen" id="ngayhenlich" class="form-control mb-3">
                                    <option value="@DateTime.Now">
                                        Hôm nay (@String.Format("{0:dd/MM/yyyy}", DateTime.Now))
                                    </option>
                                    <option value="@DateTime.Now.AddDays(1)">
                                        Ngày mai (@String.Format("{0:dd/MM/yyyy}", DateTime.Now.AddDays(1)))

                                    </option>
                                    <option value="@DateTime.Now.AddDays(2)">
                                        Ngày kia (@String.Format("{0:dd/MM/yyyy}", DateTime.Now.AddDays(2)))
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-3"></div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4 col-lg-3"></div>
                        <div class="col-md-4 col-lg-6" style="background:gray;">
                            <h3 class="mt-3">CHỌN GIỜ CẮT</h3>
                        </div>
                        <div class="col-md-4 col-lg-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 col-lg-3"></div>
                        <div class="col-md-4 col-lg-6" style="background:gray;">
                            <div>
                                <select name="giohen" id="GioHen" class="form-control mb-3">
                                    @foreach (var item in khungThoiGianModel.GetData())
                                    {
                                        string check = donDatHangModel.CheckSoNguoiDatTrenKhung(item.MaKhungThoiGian, DateTime.Now);
                                        int ck;
                                        if (check == "" || check == null)
                                        {
                                            ck = 0;
                                        }
                                        else
                                        {
                                            ck = Convert.ToInt32(check);


                                        }
                                        if (ck < 4)
                                        {
                                            <option value="@item.MaKhungThoiGian">

                                                @item.ThoiGianBatDau h- @item.ThoiGianKetThuc h 
                                            </option>
                                        }
                                        else
                                        {
                                            <option value="@item.MaKhungThoiGian" disabled>

                                                @item.ThoiGianBatDau h- @item.ThoiGianKetThuc h_ FULL
                                            </option>
                                        }
                                    }


                                </select>
                            </div>

                        </div>
                    </div>
                </div>

            </form>
        </div>


        <div class="tab">



            <div class="row mb-3">

                <div class="col-lg-7 mx-auto">
                    <div class="card shadow border-0 mb-5">
                        <div class="card-body p-5">
                            <h2 class="h4 mb-1">Chọn dịch vụ</h2>

                            <ul class="list-group">
                                @foreach (var itemdv in dichVuModel.GetData())
                                { 
                                <li class="list-group-item rounded-0">                           
                                    <label class="container-ckbox">
                                        @itemdv.TenDichVu
                                        <input type="checkbox" class="MaDV" value="@itemdv.MaDV">
                                        <span class="checkmark"></span>
                                    </label>
                                 
                                </li>
                                }
                            </ul>
                        </div>
                    </div>

                </div>>
            </div>
        </div>

        <div class="tab">
            <div class="md-form amber-textarea active-amber-textarea">
                <label for="form22">Ghi chú</label>
                <textarea id="ghichudondathang" class="md-textarea form-control" rows="8"></textarea>

            </div>
        </div>

      

        <div style="overflow:auto;">
            <div style="float:right;" class="addbtn">
                <button type="button" id="prevBtn" onclick="nextPrev(-1)">Trở lại</button>
                <button type="button" class="hidden" id="nextBtn" onclick="nextPrev(1)">Tiếp tục</button>
          
            </div>
        </div>

        <!-- Circles which indicates the steps of the form: -->
        <div style="text-align:center;margin-top:40px;">
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
     
        </div>



    </div>


    @RenderBody()
    <div class="footer-main">
        <footer style="margin-top:10px;">
            <div class="footer" id="footer">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <h4>ROYAL ĐOÀN </h4>
                            <h3>Số 12 đường 183 Tiền Trung, Ái Quốc, TP Hải Dương  </h3>
                        </div>
                        <div class="col-lg-3 col-sm-2 col-xs-3">
                            <h3> GIỜ PHỤC VỤ </h3>
                            <ul>
                                <li><a class="email" href="#"> 7h-21h</a></li>

                                <li> <p> </p> </li>
                                <li> <p> Hotline : 0902087097 </p> </li>
                            </ul>
                        </div>
                        <div class="col-lg-3 col-sm-2 col-xs-3">
                            <ul>
                                <li> <h5> <a href="#" style="margin-top: 5em"> ABOUT US</a> </h5></li>

                            </ul>
                        </div>

                        <!--/.row-->
                    </div>
                    <!--/.container-->
                </div>
                <!--/.footer-->

                <div class="footer-bottom">
                    <div class="container">
                        <p class="pull-left copyright"> Copyright © RoyalDoan. </p>
                    </div>
                </div>
                <!--/.footer-bottom-->
            </div>

        </footer>

    </div>

    <script>


        var currentTab = 0; // Current tab is set to be the first tab (0)
       // Display the current tab

        showTab(currentTab);
        function showTab(n) {
            // This function will display the specified tab of the form...
            var x = document.getElementsByClassName("tab");
            x[n].style.display = "block";
            //... and fix the Previous/Next buttons:
            if (n == 0) {
                document.getElementById("prevBtn").style.display = "none";
            } else {
                document.getElementById("prevBtn").style.display = "inline";

                $("#submitdatlich").remove();


            }
            if (n == (x.length - 1)) {



            } else {

            }
            //... and run a function that will display the correct step indicator:
            fixStepIndicator(n)
        }

        function nextPrev(n) {
            // This function will figure out which tab to display
            var x = document.getElementsByClassName("tab");
            // Exit the function if any field in the current tab is invalid:
            if (n == 1 && !validateForm()) return false;
            // Hide the current tab:
            x[currentTab].style.display = "none";
            // Increase or decrease the current tab by 1:
            currentTab = currentTab + n;
            // if you have reached the end of the form...
            if (currentTab >= x.length) {
                // ... the form gets submitted:
                $(".addbtn").append('<button type="button" id="submitdatlich" onclick="DatLich()">Đặt Lịch</button>');
                $("#nextBtn").remove();
                $("#prevBtn").remove();

                return false;
            }
            // Otherwise, display the correct tab:
            showTab(currentTab);

        }

        function validateForm() {
            // This function deals with validation of the form fields
            var x, y, i, valid = true;
            x = document.getElementsByClassName("tab");
            y = x[currentTab].getElementsByTagName("input");
            // A loop that checks every input field in the current tab:
            for (i = 0; i < y.length; i++) {
                // If a field is empty...
                if (y[i].value == "") {
                    // add an "invalid" class to the field:
                    y[i].className += " invalid";
                    // and set the current valid status to false
                    valid = false;
                }
            }
            // If the valid status is true, mark the step as finished and valid:
            if (valid) {
                document.getElementsByClassName("step")[currentTab].className += " finish";
            }
            return valid; // return the valid status
        }

        function fixStepIndicator(n) {
            // This function removes the "active" class of all steps...
            var i, x = document.getElementsByClassName("step");
            for (i = 0; i < x.length; i++) {
                x[i].className = x[i].className.replace(" active", "");
            }
            //... and adds the "active" class on the current step:
            x[n].className += " active";
        }
        $(document).ready(function () {

            $(".buttondatlich").click(function () {


                var session = "@Session["USER_SESSION"]";
                if (session != "") {


                    $(".dialog-datlich").dialog('open');
                }
                else {
                    window.location.href = "/KhachHang/DangNhap";

                }



            });

            $(".dialog-datlich").dialog({
                modal: true,
                autoOpen: false,
                width: 900,
                height: 410,
                resizable: false,
            });



            var session = "@Session["USER_SESSION"]";
            var usdn = $("#usdn").val();
            if (session != "") {
                $("#usdn").remove();
                $("#header-right").append("<a>Chào: @Session["USER_SESSION"]<a/>")
                    $("#header-right").append("<a>Xem lịch đặt<a/>")
                $("#header-right").append("<a href='/KhachHang/DangXuat'>Đăng xuất</a>")
            }


        });

        function DatLich() {
            var NgayCat = $("#ngayhenlich option:selected").val();
            var IdKhungThoiGian = $("#GioHen option:selected").val();
            var GhiChu = $("#ghichudondathang").val();
            var checkedValue = null;

            var ListIdDichVu = [];
            $("input:checkbox[class=MaDV]:checked").each(function () {
                ListIdDichVu.push($(this).val());
            });




            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '/UserHome/DatDichVu',
                data: "{ 'NgayCat':'"+NgayCat +"','IdKhungThoiGian':' "+IdKhungThoiGian+"','GhiChu':' " + GhiChu + "','ListIdDichVu':"+JSON.stringify(ListIdDichVu) +" }",
                dataType: "json",
                success: function (data) {
                    console.log('oke' + JSON.stringify(data));
                },
                error: function (data) {

                    alert(data);
                }
            });












            alert("Đặt lịch thành công !");

            $(".dialog-datlich").dialog('close');
            location.reload();



        };






    </script>


    <script src="~/Scripts/Common/Library/bootstrap.js"></script>
    <script src="~/Scripts/Common/Library/swiper-bundle.js"></script>
    <script src="~/CSS/Library/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="~/Scripts/User/UserHome.js"></script>

</body>
</html>

